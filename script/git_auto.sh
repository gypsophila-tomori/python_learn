#!/bin/bash

# ===============================================
# git_auto.sh - è‡ªåŠ¨æ‰§è¡Œ Git Add, Commit, Push
# ===============================================

# 1. æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“å†…
if ! git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    echo "âš ï¸ é”™è¯¯: å½“å‰ç›®å½•ä¸æ˜¯ä¸€ä¸ª Git ä»“åº“ã€‚"
    echo "è¯·è¿›å…¥ä½ çš„ Git é¡¹ç›®ç›®å½•åå†è¿è¡Œæ­¤è„šæœ¬ã€‚"
    exit 1
fi

# 2. è·å– Commit æ¶ˆæ¯
read -p "è¯·è¾“å…¥ Commit æ¶ˆæ¯: " commit_message

# æ£€æŸ¥ Commit æ¶ˆæ¯æ˜¯å¦ä¸ºç©º
if [ -z "$commit_message" ]; then
    echo "âŒ é”™è¯¯: Commit æ¶ˆæ¯ä¸èƒ½ä¸ºç©ºã€‚"
    exit 1
fi

# 3. æ‰§è¡Œ Git Add
echo "-----------------------------------"
echo "âœ… æ­¥éª¤ 1: æ‰§è¡Œ git add ."
git add .

# æ£€æŸ¥ add æ˜¯å¦æˆåŠŸ
if [ $? -ne 0 ]; then
    echo "âŒ é”™è¯¯: git add å¤±è´¥ï¼Œè„šæœ¬ç»ˆæ­¢ã€‚"
    exit 1
fi

# 4. æ‰§è¡Œ Git Commit
echo "âœ… æ­¥éª¤ 2: æ‰§è¡Œ git commit -m \"$commit_message\""
git commit -m "$commit_message"

# æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æäº¤ (å¦‚æœæ²¡æœ‰å˜åŠ¨ï¼Œcommit ä¼šå¤±è´¥ï¼Œä½†ä¸è®¤ä¸ºæ˜¯é”™è¯¯)
# å¦‚æœ $? ä¸º 0ï¼Œè¡¨ç¤ºæˆåŠŸæäº¤ï¼Œå¦‚æœæ˜¯ 1ï¼Œè¡¨ç¤º No changes added to commit
if [ $? -ne 0 ]; then
    echo "â„¹ï¸ æç¤º: æ²¡æœ‰æ–‡ä»¶å˜åŠ¨éœ€è¦æäº¤ï¼Œè·³è¿‡ Pushã€‚"
    exit 0
fi

# 5. æ‰§è¡Œ Git Push
echo "âœ… æ­¥éª¤ 3: æ‰§è¡Œ git push"
git push

# æ£€æŸ¥ Push æ˜¯å¦æˆåŠŸ
if [ $? -eq 0 ]; then
    echo "-----------------------------------"
    echo "ğŸ‰ æˆåŠŸ: æ‰€æœ‰æ“ä½œå®Œæˆï¼Œä»£ç å·²æ¨é€è‡³è¿œç¨‹ä»“åº“!"
else
    echo "âŒ é”™è¯¯: git push å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥è¿œç¨‹è¿æ¥æˆ–æ˜¯å¦æœ‰å†²çªã€‚"
fi

# -----------------------------------------------